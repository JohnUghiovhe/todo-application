<% include('layout') %>
<h2>Your Tasks</h2>
<form method="GET" action="/tasks" class="mb-3">
  <select name="status" class="form-select w-auto d-inline">
    <option value="">All</option>
    <option value="pending">Pending</option>
    <option value="completed">Completed</option>
    <option value="deleted">Deleted</option>
  </select>
  <button type="submit" class="btn btn-secondary">Sort</button>
  <a href="/logout" class="btn btn-danger float-end">Logout</a>
</form>
<form method="POST" action="/tasks/add" class="mb-3">
  <input type="text" name="title" class="form-control w-50 d-inline" placeholder="New task" required>
  <button type="submit" class="btn btn-success">Add Task</button>
</form>
<table class="table">
  <thead>
    <tr>
      <th>Title</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% tasks.forEach(task => { %>
      <tr>
        <td><%= task.title %></td>
        <td><%= task.status %></td>
        <td>
          <% if (task.status === 'pending') { %>
            <form method="POST" action="/tasks/<%= task._id %>/complete" style="display:inline">
              <button type="submit" class="btn btn-primary btn-sm">Complete</button>
            </form>
          <% } %>
          <% if (task.status !== 'deleted') { %>
            <form method="POST" action="/tasks/<%= task._id %>/delete" style="display:inline">
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          <% } %>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
